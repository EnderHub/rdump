# Story 1.1: Create SearchOptions Struct

## Status
Draft

## Story
**As a** library user,
**I want** a `SearchOptions` struct that contains only search-relevant parameters,
**so that** I can configure searches without dealing with CLI-specific concerns like output formatting and colors.

## Acceptance Criteria

1. - [ ] Struct derives `Debug`, `Clone`
2. - [ ] Struct is `Send + Sync` (no interior mutability)
3. - [ ] All fields use owned types (no lifetimes)
4. - [ ] `SearchOptions::default()` returns correct defaults:
   - `root`: current directory (".")
   - `presets`: empty vec
   - `no_ignore`: false (respect .gitignore)
   - `hidden`: false (skip hidden files)
   - `max_depth`: None (unlimited)
   - `sql_dialect`: None (auto-detect)
5. - [ ] Struct has module-level rustdoc with example
6. - [ ] Each field has `///` documentation
7. - [ ] `SqlDialect` is re-exported from lib.rs

## Tasks / Subtasks

- [ ] Create `SearchOptions` struct in `src/lib.rs` (AC: 1, 2, 3)
  - [ ] Define all fields with owned types
  - [ ] Add derive macros for Debug, Clone
- [ ] Implement `Default` trait (AC: 4)
  - [ ] Set root to `PathBuf::from(".")`
  - [ ] Set presets to empty vec
  - [ ] Set boolean flags to false
  - [ ] Set optional fields to None
- [ ] Add rustdoc documentation (AC: 5, 6)
  - [ ] Module-level doc with usage example
  - [ ] Document each field's purpose
- [ ] Re-export `SqlDialect` from lib.rs (AC: 7)
- [ ] Write unit tests for Default implementation

## Dev Notes

### Location
- Primary file: `src/lib.rs`
- [Source: docs/epics/library-api-epic.md - Story 1]

### Complete Implementation

```rust
/// Options for performing a search (library-friendly)
///
/// This struct contains only the parameters needed for search logic,
/// excluding CLI-specific concerns like output formatting and colors.
///
/// # Example
///
/// ```rust
/// use rdump::SearchOptions;
/// use std::path::PathBuf;
///
/// let options = SearchOptions {
///     root: PathBuf::from("/path/to/project"),
///     presets: vec!["rust".to_string()],
///     ..Default::default()
/// };
/// ```
#[derive(Debug, Clone)]
pub struct SearchOptions {
    /// Root directory to search from
    pub root: PathBuf,

    /// Named presets to apply (e.g., "rust", "python")
    pub presets: Vec<String>,

    /// If true, ignore .gitignore rules
    pub no_ignore: bool,

    /// If true, include hidden files and directories
    pub hidden: bool,

    /// Maximum directory depth to search
    pub max_depth: Option<usize>,

    /// SQL dialect override for .sql files
    pub sql_dialect: Option<SqlDialect>,
}

impl Default for SearchOptions {
    fn default() -> Self {
        Self {
            root: PathBuf::from("."),
            presets: vec![],
            no_ignore: false,
            hidden: false,
            max_depth: None,
            sql_dialect: None,
        }
    }
}
```

### Re-export SqlDialect
```rust
// In lib.rs - re-export for library users
pub use predicates::code_aware::SqlDialect;
```

### Key Implementation Details
The struct mirrors search-relevant fields from `SearchArgs` but excludes:
- `output: Option<PathBuf>` - CLI output destination
- `line_numbers: bool` - display option
- `no_headers: bool` - display option
- `format: Format` - output format
- `color: ColorChoice` - ANSI colors
- `context: Option<usize>` - context lines for display
- `find: bool` - format alias

### Current SearchArgs for Reference
**Location:** `src/lib.rs:196-277`

```rust
pub struct SearchArgs {
    // === Core search parameters (needed for library) ===
    pub query: Option<String>,
    pub dialect: Option<SqlDialectFlag>,
    pub preset: Vec<String>,
    pub root: PathBuf,
    pub no_ignore: bool,
    pub hidden: bool,
    pub max_depth: Option<usize>,

    // === CLI-only parameters (NOT needed for library) ===
    pub output: Option<PathBuf>,      // Write to file
    pub line_numbers: bool,           // Display option
    pub no_headers: bool,             // Display option
    pub format: Format,               // Output format
    pub color: ColorChoice,           // ANSI colors
    pub context: Option<usize>,       // Context lines
    pub find: bool,                   // Format alias
}
```

### Coding Standards
- [Source: docs/architecture.md#coding-standards]
- Never use `unwrap()` on user data
- All types must be `Send + Sync` for parallel evaluation
- Results must be sorted for deterministic output

### Testing

**Test Location:** Unit tests in `src/lib.rs` or dedicated test module

**Test Cases:**
```rust
#[test]
fn test_search_options_default() {
    let options = SearchOptions::default();
    assert_eq!(options.root, PathBuf::from("."));
    assert!(options.presets.is_empty());
    assert!(!options.no_ignore);
    assert!(!options.hidden);
    assert!(options.max_depth.is_none());
    assert!(options.sql_dialect.is_none());
}

#[test]
fn test_search_options_send_sync() {
    fn assert_send<T: Send>() {}
    fn assert_sync<T: Sync>() {}

    assert_send::<SearchOptions>();
    assert_sync::<SearchOptions>();
}
```

- [Source: docs/architecture.md#test-strategy]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-21 | 0.1 | Initial draft | SM Agent |
