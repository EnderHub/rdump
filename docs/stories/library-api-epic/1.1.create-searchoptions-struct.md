# Story 1.1: Create SearchOptions Struct

## Status
Done

## Story
**As a** library user,
**I want** a `SearchOptions` struct that contains only search-relevant parameters,
**so that** I can configure searches without dealing with CLI-specific concerns like output formatting and colors.

## Acceptance Criteria

1. - [x] Struct derives `Debug`, `Clone`
2. - [x] Struct is `Send + Sync` (no interior mutability)
3. - [x] All fields use owned types (no lifetimes)
4. - [x] `SearchOptions::default()` returns correct defaults:
   - `root`: current directory (".")
   - `presets`: empty vec
   - `no_ignore`: false (respect .gitignore)
   - `hidden`: false (skip hidden files)
   - `max_depth`: None (unlimited)
   - `sql_dialect`: None (auto-detect)
5. - [x] Struct has module-level rustdoc with example
6. - [x] Each field has `///` documentation
7. - [x] `SqlDialect` is re-exported from lib.rs

## Tasks / Subtasks

- [x] Create `SearchOptions` struct in `src/lib.rs` (AC: 1, 2, 3)
  - [x] Define all fields with owned types
  - [x] Add derive macros for Debug, Clone
- [x] Implement `Default` trait (AC: 4)
  - [x] Set root to `PathBuf::from(".")`
  - [x] Set presets to empty vec
  - [x] Set boolean flags to false
  - [x] Set optional fields to None
- [x] Add rustdoc documentation (AC: 5, 6)
  - [x] Module-level doc with usage example
  - [x] Document each field's purpose
- [x] Re-export `SqlDialect` from lib.rs (AC: 7)
- [x] Write unit tests for Default implementation

## Dev Agent Record
- Agent Model Used: GPT-5 (Codex CLI)
- Debug Log References: N/A
- Completion Notes:
  - Implemented `SearchOptions`, rustdoc example, field docs, and `SqlDialect` re-export in `rdump/src/lib.rs`.
  - Added defaults and unit tests for defaults plus Send/Sync bounds.
- File List:
  - rdump/src/lib.rs

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-21 | 0.1 | Initial draft | SM Agent |
| 2025-11-21 | 1.0 | Implemented SearchOptions struct, docs, defaults, tests, and SqlDialect re-export | Dev Agent |

## Dev Notes

### Location
- Primary file: `src/lib.rs`
- [Source: docs/epics/library-api-epic.md - Story 1]

### Complete Implementation

```rust
/// Options for performing a search (library-friendly)
///
/// This struct contains only the parameters needed for search logic,
/// excluding CLI-specific concerns like output formatting and colors.
///
/// # Example
///
/// ```rust
/// use rdump::SearchOptions;
/// use std::path::PathBuf;
///
/// let options = SearchOptions {
///     root: PathBuf::from("/path/to/project"),
///     presets: vec!["rust".to_string()],
///     ..Default::default()
/// };
/// ```
#[derive(Debug, Clone)]
pub struct SearchOptions {
    /// Root directory to search from
    pub root: PathBuf,

    /// Named presets to apply (e.g., "rust", "python")
    pub presets: Vec<String>,

    /// If true, ignore .gitignore rules
    pub no_ignore: bool,

    /// If true, include hidden files and directories
    pub hidden: bool,

    /// Maximum directory depth to search
    pub max_depth: Option<usize>,

    /// SQL dialect override for .sql files
    pub sql_dialect: Option<SqlDialect>,
}

impl Default for SearchOptions {
    fn default() -> Self {
        Self {
            root: PathBuf::from("."),
            presets: vec![],
            no_ignore: false,
            hidden: false,
            max_depth: None,
            sql_dialect: None,
        }
    }
}
```

### Re-export SqlDialect
```rust
// In lib.rs - re-export for library users
pub use predicates::code_aware::SqlDialect;
```

### Key Implementation Details
The struct mirrors search-relevant fields from `SearchArgs` but excludes:
- `output: Option<PathBuf>` - CLI output destination
- `line_numbers: bool` - display option
- `no_headers: bool` - display option
- `format: Format` - output format
- `color: ColorChoice` - ANSI colors
- `context: Option<usize>` - context lines for display
- `find: bool` - format alias

### Current SearchArgs for Reference
**Location:** `src/lib.rs:196-277`

```rust
pub struct SearchArgs {
    // === Core search parameters (needed for library) ===
    pub query: Option<String>,
    pub dialect: Option<SqlDialectFlag>,
    pub preset: Vec<String>,
    pub root: PathBuf,
    pub no_ignore: bool,
    pub hidden: bool,
    pub max_depth: Option<usize>,

    // === CLI-only parameters (NOT needed for library) ===
    pub output: Option<PathBuf>,      // Write to file
    pub line_numbers: bool,           // Display option
    pub no_headers: bool,             // Display option
    pub format: Format,               // Output format
    pub color: ColorChoice,           // ANSI colors
    pub context: Option<usize>,       // Context lines
    pub find: bool,                   // Format alias
}
```

### Coding Standards
- [Source: docs/architecture.md#coding-standards]
- Never use `unwrap()` on user data
- All types must be `Send + Sync` for parallel evaluation
- Results must be sorted for deterministic output

### Testing

**Test Location:** Unit tests in `src/lib.rs` or dedicated test module

**Test Cases:**
```rust
#[test]
fn test_search_options_default() {
    let options = SearchOptions::default();
    assert_eq!(options.root, PathBuf::from("."));
    assert!(options.presets.is_empty());
    assert!(!options.no_ignore);
    assert!(!options.hidden);
    assert!(options.max_depth.is_none());
    assert!(options.sql_dialect.is_none());
}

#[test]
fn test_search_options_send_sync() {
    fn assert_send<T: Send>() {}
    fn assert_sync<T: Sync>() {}

    assert_send::<SearchOptions>();
    assert_sync::<SearchOptions>();
}
```

- [Source: docs/architecture.md#test-strategy]

## QA Results

### Review Date: 2025-11-21

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall: Excellent** - Implementation is clean, well-documented, and follows Rust idioms correctly. The struct properly separates library-facing concerns from CLI-specific concerns.

**Implementation Highlights:**
- Correctly uses `#[derive(Debug, Clone)]` for the struct
- All fields use owned types with no lifetimes, ensuring `Send + Sync` compatibility
- Default implementation provides correct values per specification
- Module-level rustdoc includes a working, compilable example
- Each field has clear `///` documentation explaining its purpose
- `SqlDialect` is properly re-exported for library consumers

### Refactoring Performed

None required - implementation is clean and meets all requirements.

### Compliance Check

- Coding Standards: ✓ No unwrap() on user data, types are Send + Sync
- Project Structure: ✓ Code is in correct location (src/lib.rs)
- Testing Strategy: ✓ Unit tests verify defaults and Send+Sync bounds
- All ACs Met: ✓ All 7 acceptance criteria verified in implementation

### Improvements Checklist

All items completed satisfactorily:

- [x] Struct derives Debug, Clone (line 169)
- [x] Struct is Send + Sync verified by test
- [x] All fields use owned types (PathBuf, Vec, bool, Option)
- [x] Default implementation returns correct values (lines 190-201)
- [x] Module-level rustdoc with example (lines 1-17)
- [x] Each field has documentation (lines 171-187)
- [x] SqlDialect re-exported (line 159)

### Security Review

No security concerns - this is a simple data struct with no authentication, authorization, or data protection implications.

### Performance Considerations

No performance concerns - struct uses efficient owned types and Default implementation is O(1).

### Files Modified During Review

None - no modifications were necessary.

### Gate Status

Gate: PASS → docs/qa/gates/1.1-create-searchoptions-struct.yml

### Recommended Status

✓ Ready for Done

All acceptance criteria have been met, tests pass, and the implementation follows project coding standards. The struct is well-documented and correctly separates library concerns from CLI concerns.
